"""
Malware Signature Scanner

Scans files and directories for suspicious patterns and malware signatures using regex rules.
"""

import os
import re

MALWARE_PATTERNS = [
    re.compile(r"eval\("), re.compile(r"base64_decode\("), re.compile(r"exec\("),
    re.compile(r"wget\s"), re.compile(r"curl\s"), re.compile(r"nc\s"),
]

def scan_malware(path="."):
    findings = []
    for root, dirs, files in os.walk(path):
        for fname in files:
            fpath = os.path.join(root, fname)
            try:
                with open(fpath, "r", errors="ignore") as f:
                    content = f.read()
                    for pat in MALWARE_PATTERNS:
                        if pat.search(content):
                            findings.append({
                                "file": fpath,
                                "pattern": pat.pattern,
                            })
            except Exception:
                continue
    return findings
